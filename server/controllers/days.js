var mongoose = require('mongoose');
var malModel = mongoose.model('Days');

var sendJSONresponse = function(res, status, content){
    res.status(status);
    res.json(content);
};

/* GET a list of all the malware events*/
module.exports.malList = function(req, res) {
    console.log('Getting malware events list');
    malModel
        .find()
        .exec(function(err, results) {
  	    if (!results) {
          sendJSONresponse(res, 404, {
  		    "message": "no malware events found"
  		    });
          return;

  	    } else if (err) {
        		console.log(err);
        		sendJSONresponse(res, 404, err);
        		return;
  	    }
  	    console.log(results);
  	    sendJSONresponse(res, 200, buildMalList(req, res, results));
  	});
};

/* builds a list of malware events */
var buildMalList = function(req, res, results){
    var days = [];
    results.forEach(function(obj) {
    	days.push({
           _id: obj._id,
          day: obj.day,
          incidents: obj.incidents,
          malware_list: obj.malware_list
    	});
    });
    return days;
};
